(function(win,doc){"use strict";var LOGIN_URL="//id.ifeng.com/allsite/login",LOGIN_SID_INTERVAL=null,LOGIN_TK_INTERVAL=null,LOGIN_IF_REAL=null,LOGIN_SUCCESS_CALLBACK=[],LOGIN_CLOSE_CALLBACK=[],LOGIN_OUT_CALLBACK=[],login_init=function(){if(login_cookie.get("sid")){if(LOGIN_SUCCESS_CALLBACK.length>0)for(var e=0,n=LOGIN_SUCCESS_CALLBACK.length;e<n;e++)LOGIN_SUCCESS_CALLBACK[e]({sid:login_cookie.get("sid"),uname:_processSidtoUname()})}else _loginShow()},_login_listening=function(){clearInterval(LOGIN_TK_INTERVAL),clearInterval(LOGIN_SID_INTERVAL),clearInterval(LOGIN_IF_REAL),LOGIN_TK_INTERVAL=setInterval(_processTK,100),LOGIN_SID_INTERVAL=setInterval(_processSID,100),LOGIN_IF_REAL=setInterval(_ifRealName,100)},_ifRealName=function(){login_cookie.get("sid")&&0==login_cookie.get("IF_REAL")&&(clearInterval(LOGIN_IF_REAL),doc.getElementById("login_index")&&doc.getElementById("login_index").parentNode.removeChild(doc.getElementById("login_index")),doc.getElementById("masker")&&doc.getElementById("masker").parentNode.removeChild(doc.getElementById("masker")))},_processSID=function(){var e={};if(login_cookie.get("sid")&&(e.sid=login_cookie.get("sid"),e.uname=_processSidtoUname(),clearInterval(LOGIN_SID_INTERVAL),clearInterval(LOGIN_TK_INTERVAL),0==login_cookie.get("IF_REAL")&&(clearInterval(LOGIN_IF_REAL),doc.getElementById("login_index")&&doc.getElementById("login_index").parentNode.removeChild(doc.getElementById("login_index")),doc.getElementById("masker")&&doc.getElementById("masker").parentNode.removeChild(doc.getElementById("masker"))),LOGIN_SUCCESS_CALLBACK.length>0))for(var n=0,o=LOGIN_SUCCESS_CALLBACK.length;n<o;n++)LOGIN_SUCCESS_CALLBACK[n](e)},_processTK=function(){var OTK="";""!==login_cookie.get("IF_OTK")&&(clearInterval(LOGIN_TK_INTERVAL),OTK=eval("("+decodeURIComponent(login_cookie.get("IF_OTK"))+")"),1===OTK.code?(login_cookie.del("IF_OTK",".ifeng.com"),doc.getElementById("login_iframe_out").innerHTML='<iframe id="login_iframe" width="520" height="410" scrolling="no" frameborder="no" border="0" style="border:0px; margin:0px;padding:0px;" src="'+OTK.data.url+'"></iframe>'):(login_cookie.del("IF_OTK",".ifeng.com"),doc.getElementById("login_iframe_out").innerHTML='<iframe id="login_iframe" width="520" height="410" scrolling="no" frameborder="no" border="0" style="border:0px; margin:0px;padding:0px;" src="'+LOGIN_URL+'"></iframe>',alert(OTK.message)),_login_listening())},_loginShow=function(){var e=doc.body,n=doc.getElementById("login_index"),o=null,i=null,t=_getDom(e.lastChild);"undefined"!=typeof t&&("undefined"==typeof n||null===n?(o=doc.createElement("div"),o.id="masker",o.style.cssText="background:#000; position:fixed; left:0; top:0; bottom:0px; width:100%; height:100%; opacity:.80; filter:alpha(opacity=80); z-index:9999; overflow:hidden; zoom: 1; display: block;",t.parentNode.insertBefore(login_html(),t),doc.getElementById("login_index").parentNode.insertBefore(o,doc.getElementById("login_index")),doc.getElementById("login_iframe_contain").style.cssText="position:fixed; _position:absolute; top:50%; left:50%; margin-left:-260px; margin-top: -207px; z-index:99999;"):(doc.getElementById("login_iframe_out")&&(doc.getElementById("login_iframe_out").innerHTML='<iframe id="login_iframe" width="520" height="410" scrolling="no" frameborder="no" border="0" style="border:0px; margin:0px;padding:0px;" src="'+LOGIN_URL+'"></iframe>'),o=doc.getElementById("masker"),o.style.display="block",n.style.display="block"),i=doc.getElementById("login_iframe_close_btn"),_bindEvent.add(i,"click",_loginHide),_login_listening())},_loginHide=function(){if(clearInterval(LOGIN_TK_INTERVAL),clearInterval(LOGIN_SID_INTERVAL),doc.getElementById("login_index")&&doc.getElementById("login_index").parentNode.removeChild(doc.getElementById("login_index")),doc.getElementById("masker")&&doc.getElementById("masker").parentNode.removeChild(doc.getElementById("masker")),LOGIN_CLOSE_CALLBACK.length>0)for(var e=0,n=LOGIN_CLOSE_CALLBACK.length;e<n;e++)LOGIN_CLOSE_CALLBACK[e]()},login_out=function(){var e=function(e){var n=0,o="",i=[],t=null,l=null,r=null;if(1===e.code){for(;n<e.data.turl.length;n++)o='<iframe style="display: none;" id="logout_'+n+'_iframe" src="'+e.data.turl[n]+'"></iframe>',i.push(o);t=document.createElement("div"),t.id="iframesDIV",t.innerHTML=i.join(""),l=_getDom(document.body.lastChild),l.parentNode.insertBefore(t,l),r=setInterval(function(){if(""===login_cookie.get("sid")&&(clearInterval(r),LOGIN_OUT_CALLBACK.length>0))for(var e=0,n=LOGIN_OUT_CALLBACK.length;e<n;e++)LOGIN_OUT_CALLBACK[e]()},100)}},n={url:"//id.ifeng.com/index.php/api/logout",success:e};ajax.jsonp(n)},_getDom=function(e){return 1===e.nodeType?e:e.previousSibling?_getDom(e.previousSibling):null},_bindEvent={add:function(e,n,o){e.attachEvent?(e["e"+n+o]=o,e[n+o]=function(){e["e"+n+o](window.event)},e.attachEvent("on"+n,e[n+o])):e.addEventListener(n,o,!1)},remove:function(e,n,o){e.detachEvent?(e.detachEvent("on"+n,e[n+o]),e[n+o]=null):e.removeEventListener(n,o,!1)}},login_html=function(){var e=doc.createElement("div"),n="//y0.ifengimg.com/a/2015/0827/close_small.png";return e.id="login_index",e.style.cssText="width:1000px; margin:0 auto; display: block;",e.innerHTML='<div id="login_iframe_contain"><i id="login_iframe_close_btn" style="cursor:pointer; position:absolute; right:-10px; top:-10px;"><a href="javascript:;" style="cursor:pointer;width:26px;height:26px;overflow:hidden;background:url('+n+") no-repeat;display:block;text-indent:-9999px;_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src='"+n+'\');">关闭</a></i><div id="login_iframe_out"><iframe id="login_iframe" width="520" height="410" scrolling="no" frameborder="no" border="0" style="border:0px; margin:0px;padding:0px;" src="'+LOGIN_URL+'"></iframe></div></div>',e},login_cookie={get:function(e){for(var n=login_cookie,o=document.cookie,i=n._removeBlanks(o),t=i.split(";"),l=0;l<t.length;l++){var r=t[l].split("=");if(r.length>1&&r[0]===e)return r[1]}return""},del:function(e,n){document.cookie=e+"=; path=/; domain="+n+"; expires=Thu, 01-Jan-70 00:00:01 GMT"},_removeBlanks:function(e){for(var n="",o=0;o<e.length;o++){var i=e.charAt(o);" "!==i&&(n+=i)}return n}},ajax={jsonp:function(e){var n,o=e.url,i=e.success,t=[],l=e.scope||window;if("object"==typeof e.data)for(var r in e.data)t.push(r+"="+encodeURIComponent(e.data[r]));n="string"==typeof e.callback&&""!==e.callback?e.callback:"f"+(new Date).valueOf().toString(16),t.push("callback="+n),t.push("_="+(new Date).valueOf()),o=o.indexOf("?")<0?o+"?"+t.join("&"):o+"&"+t.join("&");var d=document.createElement("script");d.src=o,window[n]=function(){i.apply(l,[].slice.apply(arguments).concat("success",e))};var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)}},_processSidtoUname=function(){return login_cookie.get("IF_USER")?decodeURIComponent(login_cookie.get("IF_USER")):"凤凰网友"},isLogin=function(){return!!login_cookie.get("sid")},regLoginCallback=function(e,n){if("undefined"==typeof e||"undefined"==typeof n)return!1;switch(e){case 1:if("function"==typeof n){LOGIN_SUCCESS_CALLBACK.push(n);break}case 2:if("function"==typeof n){LOGIN_CLOSE_CALLBACK.push(n);break}case 3:if("function"==typeof n){LOGIN_OUT_CALLBACK.push(n);break}}},reviewCheck=function(){return login_cookie.get("sid")?0==login_cookie.get("IF_REAL")||(_loginShow(),document.getElementById("login_iframe").src="//id.ifeng.com/allsite/loginmob",!1):(_loginShow(),!1)};win.IS_LOGIN=isLogin,win.GLOBAL_LOGIN=login_init,win.GLOBAL_LOGIN_OUT=login_out,win.REG_LOGIN_CALLBACK=regLoginCallback,win.ReviewCheck=reviewCheck})(window,document);